{% extends "header.html" %}






{% block container%}


    <script type="text/javascript">
            $(document).ready(function(){
                namespace = '/new';
                socket = io.connect('http://' + document.domain + ':' + location.port + namespace);
                socket.on('new_host_up', function(msg) {
                    console.log('new HOST: ' + msg.ip +' up' + '  mac:' + msg.mac)
                    $('#newhost').empty();
                    $('#newhost').append('有新主机上线了！ip:' + msg.ip +'  mac:' + msg.mac + '<br>');
                    $('#hosts').bootstrapTable('append',msg);
                });
            });



    </script>
    <script type="text/javascript">
        $(document).ready(function () {
            $('#hosts').bootstrapTable({
                method: "get",
                url:"/refresh",
                pagination: true,
                showRefresh: true,

                icons: {
                    refresh: 'glyphicon-repeat',
                    toggle: 'glyphicon-list-alt',
                    columns: 'glyphicon-list'
                },
                columns: [{
                    field: 'ip',
                    title: 'IP 地址'
                }, {
                    field: 'mac',
                    title: 'MAC 地址'
                }, {
                    field: 'status',
                    title: '状态'
                }]

            });

        });
        $(document).ready(function () {
            namespace = '/refresh';
            socket = io.connect('http://' + document.domain + ':' + location.port + namespace);
            socket.on('list', function(msg) {
                    console.log('HOST up!' + msg[0].ip);
                    $('#hosts').bootstrapTable('load',msg);
            });
            setInterval(function() {
                    $.get("{{ url_for('refresh') }}");
            },1000*60*5);
        });





    </script>



    <h3>主机列表</h3>
        <button id="background" type="button" class="btn btn-default">更新列表</button>


        <div id='log'></div>
        <div id='log2'></div>
        <div  id="newhost" class="alert alert-warning alert-dismissible" role="alert">
            <button type="button" class="close" data-dismiss="alert"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            <strong>Warning! new host up!</strong>
        </div>


    <table class="table table-bordered" align="center" valign="middle">
    <thead>
      <tr>
          <th>ip地址 </th>
          <th>mac地址</th>
          <th>状态</th>
      </tr>
    </thead>
    <tbody id="ip">

    </tbody>

    </table>

    <table id="hosts">
    <thead>
      <tr>
          <th>ip地址 </th>
          <th>mac地址</th>
          <th>状态</th>
      </tr>
    </thead>
    </table>

    <script type="text/javascript" src="{{ url_for('static', filename='js/bootstrap-table.min.js') }}"></script>
    <script type="text/javascript" src="{{ url_for('static', filename='js/bootstrap-table-zh-CN.min.js') }}"></script>


{% endblock %}